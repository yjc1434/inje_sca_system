<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>인제대학교 동아리연합회</title>
    <link rel="stylesheet" href="/static/css/inje-settings.css">
    <script type = "text/javascript" src = "/static/js/inje-script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.15.5/xlsx.full.min.js"></script>
</head>
<body> 
    <div class="container-fluid px-0">
        <header class="p-4 mb-4 border-bottom text-center">
            <a href="/">
                <img src="/static/resource/sca_system_logo.svg" style="min-height:20px;max-height:50px;" alt="">
            </a>
        </header>
        <div class="container my-5">
            <div class="pp-5 mb-4 bg-light rounded-3 vertical-center" style="min-height:500px">
                <div class="d-block m-auto">
                    <h1 class="text-center mb-3">투표 수정</h1>
                    <h6 class="text-center mb-3" id="clock"></h6>
                    <div class="line my-5"></div>
                    <div class="row align-items-center password_card" style= "max-width: 700px;">
                            <div class="col-12 col-md-3 text-center-md">
                                <label for="_title" class="col-form-label mb-3">제목</label>
                            </div>
                            <div class="col-12 col-md-9">
                                <input type="text" class="form-control mb-3" id="_title" name="_title"
                                    placeholder="제목 입력">
                            </div>
                            <div class="col-12 col-md-3 text-center-md"><label for="_subject" class="col-form-label mb-3">설명</label></div>
                            <div class="col-12 col-md-9">
                                <textarea type="text" class="form-control mb-3" id="_subject" name="_subject"
                                placeholder="설명 입력" style="resize: none; height: 100px"></textarea>
                            </div>
                            <div class="col-12 col-md-3 text-center-md">
                                <label for="_endtime" class="col-form-label mb-3">종료일자</label>
                            </div>
                            <div class="col-12 col-md-9">
                                <div class="row mb-3">
                                    <div class="col-4 pe-1">
                                        <input type="text" class="form-control" id="_endday_yy" name="_endday_yy"
                                        placeholder="년(4자리)">
                                    </div>
                                    <div class="col-4 px-2">
                                        <input type="text" class="form-control" id="_endday_mm" name="_endday_mm"
                                        placeholder="월">
                                    </div>
                                    <div class="col-4 ps-1">
                                        <input type="text" class="form-control" id="_endday_dd" name="_endday_dd"
                                        placeholder="일">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-3 text-center-md">
                                <label for="_endtime" class="col-form-label mb-3">종료시간</label>
                            </div>
                            <div class="col-12 col-md-9">
                                <div class="row mb-3">
                                    <div class="col-4 pe-1">
                                        <select class="form-select" id="_endtime_apm">
                                            <option value="am">오전</option>
                                            <option value="pm">오후</option>
                                        </select>
                                    </div>
                                    <div class="col-4 px-2">
                                        <select type="text" class="form-select" id="_endtime_hh" name="_endtime_hh" placeholder="시">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="0" selected>12</option>
                                        </select>
                                    </div>
                                    <div class="col-4 ps-1">
                                        <select type="text" class="form-select" id="_endtime_mm" name="_endtime_mm" placeholder="분">
                                            <option value="0">00</option>
                                            <option value="5">05</option>
                                            <option value="10">10</option>
                                            <option value="15">15</option>
                                            <option value="20">20</option>
                                            <option value="25">25</option>
                                            <option value="30">30</option>
                                            <option value="35">35</option>
                                            <option value="40">40</option>
                                            <option value="45">45</option>
                                            <option value="50">50</option>
                                            <option value="55">55</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="w-100 mb-5"></div>
                            <div class="col-12 col-md-6">
                                <button onclick="voteEdit()" class="btn btn-primary w-100 mb-3">완료</button>
                            </div>
                            <div class="col-12 col-md-6">
                                <button class="btn btn-gray w-100 mb-3" onclick="location.href='/admin/vote'"
                                    style="background-color: rgb(223, 223, 223);">뒤로가기</button>
                            </div>
                            <div class="w-100 mb-3"></div>
                            <div class="text-center text-danger mb-3 invisible" name="label" style="padding: 0px;">오류메시지 출력란</div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="text-center p-5">
            <img class="logo" src="/static/resource/sca_logo_gray.svg" alt="">
            <div class="mb-5"></div>
            <p class="footer-text">(50834) 경상남도 김해시 인제로 197 늘빛관(학생회관) 323호</p>
            <p class="footer-text" style="color:#ccc">ⓒ 2022 INJE University All Rights Reserved.</p>
        </footer>
    </div>
</body>
<script type = "text/javascript" src = "/static/js/clock-interval.js"></script>
<script>
    //init
    setInfo();
    //init
    
    function dateconvert(old_date){ //날짜를 형식에 맞춰서 변환해주는 함수
        let date = old_date.toString().split(' ');
        let result = date[3] + "-";
        //월
        if (date[1] == 'Jan') {
            result += "1-";
        } else if (date[1] == 'Feb') {
            result += "2-";
        } else if (date[1] == 'Mar') {
            result += "3-";
        } else if (date[1] == 'Apr') {
            result += "4-";
        } else if (date[1] == 'May') {
            result += "5-";
        } else if (date[1] == 'Jun') {
            result += "6-";
        } else if (date[1] == 'Jul') {
            result += "7-";
        } else if (date[1] == 'Aug') {
            result += "8-";
        } else if (date[1] == 'Sep') {
            result += "9-";
        } else if (date[1] == 'Oct') {
            result += "10-";
        } else if (date[1] == 'Nov') {
            result += "11-";
        } else if (date[1] == 'Dec') {
            result += "12-";
        }

        result += date[2];

        times = date[4].split(":");

        if (parseInt(times[0]) >= 12) { //오후
            result += " pm ";
            times[0] = (parseInt(times[0]) - 12).toString();
            if (times[0] == '00') times[0] = ' 12';
        }
        else if (times[0] == '00') times[0] = ' 12';
        else {
            result += " am ";
        }

        result += times[0] +":" + times[1];
        return result;
    }

    function setInfo() {
        let year,month,day;
        let new_date = dateconvert('<%= vote_endtime %>').split(' ');
   
        let days = new_date[0].split('-');
        let apm = new_date[1];
        let times = new_date[2].split(':');
  
        document.getElementById('_title').value = '<%= vote_name %>'
        document.getElementById('_subject').value = '<%= vote_subject %>'

        document.getElementById('_endday_yy').value = days[0];
        document.getElementById('_endday_mm').value = days[1];
        document.getElementById('_endday_dd').value = days[2];

        selectBoxChange('_endtime_apm',apm);
        selectBoxChange('_endtime_hh', parseInt(times[0]));
        selectBoxChange('_endtime_mm',parseInt(times[1]));
    }

    function tct(str) {
        if (str.length == 1) return "0" + str;
        return str;
    }

    function date() {
        var year = document.getElementById('_endday_yy').value;
        var month = document.getElementById('_endday_mm').value;
        var day = document.getElementById('_endday_dd').value;
        var apm = document.getElementById('_endtime_apm').value;
        var hour = document.getElementById('_endtime_hh').value;
        var min = document.getElementById('_endtime_mm').value;
        if (year.length == 4) {
            if (month >= 1 && month <= 12) {
                if (day >= 1 && day <= 31) {
                    let dates = year + "-" + tct(month) + "-" + tct(day);
                    if (apm == 'pm') hour = parseInt(hour) + parseInt(12);
                    dates += " " + tct(hour) + ":" + tct(min) + ":00";
                    return dates;
                }
            }
        }
        else {
            alert('입력 양식을 확인해주세요!');
        }
    }

    function voteEdit() {
        var name = document.getElementById('_title').value;
        var sub = document.getElementById('_subject').value;
        var end = date();

        console.log(name,sub,end)

        if (name == '' || sub == '') {
            alert('빈칸을 입력해주세요!');
        }
        else if (new Date(end) <= new Date()) {
            alert('현재 시간 이후로 종료시간을 설정해주세요!');
        }
        else {
            if(confirm("추가하시겠습니까?")) {
                var form = document.createElement('form');
                form.setAttribute('method', 'post');
                form.setAttribute('action', '/admin/vote/edit/commit');    
        
                var input1 = document.createElement('input');
                input1.setAttribute('type', 'hidden');
                input1.setAttribute('name', 'vote_name');
                input1.setAttribute('value', name);
                
                var input2 = document.createElement('input');
                input2.setAttribute('type', 'hidden');
                input2.setAttribute('name', 'vote_subject');
                input2.setAttribute('value', sub);

                var input3 = document.createElement('input');
                input3.setAttribute('type', 'hidden');
                input3.setAttribute('name', 'vote_endtime');
                input3.setAttribute('value', end);

                var input4 = document.createElement('input');
                input4.setAttribute('type', 'hidden');
                input4.setAttribute('name', 'vote_id');
                input4.setAttribute('value', '<%=vote_id%>');

                form.appendChild(input1);
                form.appendChild(input2);
                form.appendChild(input3);
                form.appendChild(input4);
                
                document.body.appendChild(form);
                form.submit();
            }
            else {
                return
            }
        }
    }
</script>
</html>